<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marché Fruits, Légumes & Unités</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body { background: #f0fff0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding-top: 80px; padding-bottom: 80px; }
header, footer { position: fixed; left: 0; right: 0; background: linear-gradient(90deg, #28a745, #5cd65c); color: #fff; padding: 1rem; z-index: 1030; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
header { top: 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #fff; }
footer { bottom: 0; text-align: center; border-top: 3px solid #fff; }
header h1 { font-size: 1.5rem; font-weight: bold; margin: 0; letter-spacing: 1px; }
.cart-icon { position: relative; cursor: pointer; }
.cart-badge { position: absolute; top: -8px; right: -10px; background: #ffc107; color: #000; border-radius: 50%; padding: 3px 8px; font-size: 0.85rem; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
.filter-container { margin-bottom: 20px; }
.product-card { border: 2px solid #5cd65c; border-radius: 15px; margin-bottom: 2rem; padding: 1.5rem; background: #fff; box-shadow: 0 6px 12px rgba(0,0,0,0.15); text-align: center; transition: transform 0.3s, box-shadow 0.3s; }
.product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
.product-card img { border-radius: 12px; margin-bottom: 1rem; border: 1px solid #ddd; }
.product-title { font-size: 1.3rem; font-weight: 700; margin-bottom: 0.5rem; color: #28a745; }
.price { font-size: 1.1rem; color: #dc3545; margin-bottom: 0.6rem; font-weight: bold; }
.quantity-control { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 1rem; }
.quantity-control button { background: #28a745; color: #fff; border: none; border-radius: 8px; width: 36px; height: 36px; font-size: 1.2rem; transition: background 0.3s; }
.quantity-control button:hover { background: #1e7e34; }
.quantity-display { font-weight: 600; font-size: 1.05rem; color: #333; min-width: 90px; }
.btn-add { background: linear-gradient(90deg, #dc3545, #ff6b6b); border: none; border-radius: 10px; color: #fff; padding: 0.6rem 1rem; width: 100%; font-weight: 600; transition: background 0.3s; }
.btn-add:hover { background: linear-gradient(90deg, #a71d2a, #ff4d4d); }
.modal-content { border-radius: 20px; display: flex; flex-direction: column; max-height: 80vh; }
.modal-header, .modal-footer { position: sticky; z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.modal-header { top: 0; background: linear-gradient(90deg, #28a745, #5cd65c); color: #fff; border-bottom: 2px solid #fff; }
.modal-footer { bottom: 0; background: #fff; padding-top: 10px; padding-bottom: 10px; border-top: 2px solid #28a745; }
.modal-body { overflow-y: auto; padding: 1.2rem; }
.form-control { border: 1px solid #28a745; border-radius: 8px; margin-bottom: 12px; padding: 0.6rem; }
.remove-btn { color: #dc3545; cursor: pointer; font-size: 1.2rem; transition: color 0.3s; }
.remove-btn:hover { color: #ff6b6b; }
@media (max-width: 576px) {
  .filter-btns { display: none; }
}
</style>
</head>
<body>
<header>
<h1>Marché Fruits, Légumes & Unités</h1>
<div class="cart-icon" data-bs-toggle="modal" data-bs-target="#cartModal">
<i class="fas fa-shopping-cart fa-2x"></i>
<span class="cart-badge" id="cart-count">0</span>
</div>
</header>

<main class="container mt-3">
<div class="filter-container text-center">
  <select id="filter-select" class="form-select w-50 mx-auto">
    <option value="all" selected>Tous</option>
    <option value="fruits">Fruits</option>
    <option value="legumes">Légumes</option>
    <option value="unite">Unités</option>
  </select>
</div>
<div id="products-list" class="row"></div>
</main>

<footer>
&copy; 2025 Marché Fruits, Légumes & Unités - Tous droits réservés
</footer>

<div class="modal fade" id="cartModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Votre Panier</h5>
<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div id="cart-items"></div>
<hr>
<input type="text" class="form-control" id="client-name" placeholder="Nom complet">
<input type="text" class="form-control" id="client-address" placeholder="Adresse">
<textarea class="form-control" id="client-comment" placeholder="Commentaire"></textarea>
</div>
<div class="modal-footer">
<button class="btn btn-success w-100" onclick="validateOrder()">Valider la commande</button>
</div>
</div>
</div>
</div>

<script>
const products = [
{ id: 1, name: "Pomme", price: 5, img: "https://via.placeholder.com/400x250?text=Pomme", category: 'fruits' },
{ id: 2, name: "Banane", price: 6, img: "https://via.placeholder.com/400x250?text=Banane", category: 'fruits' },
{ id: 3, name: "Carotte", price: 4, img: "https://via.placeholder.com/400x250?text=Carotte", category: 'legumes' },
{ id: 4, name: "Tomate", price: 5, img: "https://via.placeholder.com/400x250?text=Tomate", category: 'legumes' },
{ id: 5, name: "Oeuf", price: 3, img: "https://via.placeholder.com/400x250?text=Oeuf", category: 'unite' },
{ id: 6, name: "Citron", price: 2, img: "https://via.placeholder.com/400x250?text=Citron", category: 'unite' }
];

let cart = [];
let quantities = {};
products.forEach(p => quantities[p.id] = 1);

function renderProducts(filter='all'){
const container = document.getElementById("products-list");
container.innerHTML="";
products.filter(p => filter==='all' || p.category===filter).forEach(p=>{
let qtyDisplay = p.category==='unite'?`${quantities[p.id]} unité(s)`:`${quantities[p.id]} × 250g = ${quantities[p.id]*250}g`;
container.innerHTML+=`
<div class="col-12">
<div class="product-card">
<img src="${p.img}" alt="${p.name}" class="img-fluid">
<div class="product-title">${p.name}</div>
<div class="price">${p.price} MAD ${p.category==='unite'?'/ unité':'/ 250g'}</div>
<div class="quantity-control">
<button onclick="changeQty(${p.id}, -1)">-</button>
<span id="qty-${p.id}" class="quantity-display">${qtyDisplay}</span>
<button onclick="changeQty(${p.id}, 1)">+</button>
</div>
<button class="btn-add" onclick="addToCart(${p.id})"><i class="fas fa-cart-plus"></i> Ajouter au panier</button>
</div>
</div>`;
});
}

document.getElementById('filter-select').addEventListener('change', ()=>{
renderProducts(document.getElementById('filter-select').value);
});

function changeQty(id, delta){
if(!quantities[id]) quantities[id]=1;
quantities[id]=Math.max(1, quantities[id]+delta);
const product=products.find(p=>p.id===id);
let qtyDisplay=product.category==='unite'?`${quantities[id]} unité(s)`:`${quantities[id]} × 250g = ${quantities[id]*250}g`;
document.getElementById(`qty-${id}`).textContent=qtyDisplay;
}

function addToCart(id){
const product=products.find(p=>p.id===id);
const qty=quantities[id]||1;
const grams=product.category==='unite'?qty:qty*250;
const existingIndex=cart.findIndex(item=>item.id===id);
if(existingIndex!==-1){
Swal.fire({
title:'Article déjà dans le panier',
text:`Voulez-vous supprimer ${product.name} du panier pour le re-choisir avec une nouvelle quantité ?`,
icon:'warning',
showCancelButton:true,
confirmButtonText:'Supprimer',
cancelButtonText:'Annuler'
}).then((result)=>{if(result.isConfirmed){cart.splice(existingIndex,1);renderCart();updateCartCount();}});
return;
}
cart.push({...product, qty, grams});
updateCartCount();
renderCart();
Swal.fire({icon:'success', title:'Ajouté au panier', text:`${qty} ${product.category==='unite'?'unité(s)':'× 250g'} (${grams}${product.category==='unite'?'':'g'}) de ${product.name}`});
}

function updateCartCount(){document.getElementById("cart-count").textContent=cart.length;}

function renderCart(){
const cartContainer=document.getElementById("cart-items");
cartContainer.innerHTML="";
cart.forEach((item,index)=>{
cartContainer.innerHTML+=`
<div class="d-flex align-items-center mb-2 border-bottom pb-2">
<img src="${item.img}" width="60" class="me-2 rounded">
<div><strong>${item.name}</strong><br>${item.qty} ${item.category==='unite'?'unité(s)':'× 250g = '+item.grams+'g'}<br><span class="text-success">${item.price} MAD ${item.category==='unite'?'/ unité':'/ 250g'}</span></div>
<i class="fas fa-trash remove-btn ms-auto" onclick="removeFromCart(${index})"></i>
</div>`;
});
}

function removeFromCart(index){cart.splice(index,1);updateCartCount();renderCart();}

function validateOrder(){
if(cart.length===0){Swal.fire('Panier vide','Ajoutez au moins un produit','warning'); return;}
const name = document.getElementById('client-name').value.trim();
const address = document.getElementById('client-address').value.trim();
const comment = document.getElementById('client-comment').value.trim();
if(!name || !address){Swal.fire('Champs manquants','Veuillez remplir votre nom et adresse','warning'); return;}

let message = `Bonjour,\nCommande:\n`;
cart.forEach((item,index)=>{
let quantityText = item.category==='unite' ? `${item.qty} unité(s)` : `${item.grams}g`;
message += `${index + 1}. ${item.name} = ${quantityText}\n`;
});
message += `Nom: ${name}\nAdresse: ${address}\nCommentaire: ${comment}`;
const encodedMessage = encodeURIComponent(message);
window.open(`https://wa.me/212608975435?text=${encodedMessage}`);

Swal.fire('Merci!','Votre commande sera préparée et prête à la caisse.','success');
cart=[];updateCartCount();renderCart();
document.getElementById('client-name').value='';
document.getElementById('client-address').value='';
document.getElementById('client-comment').value='';
}

document.addEventListener('DOMContentLoaded',()=>{renderProducts();});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
